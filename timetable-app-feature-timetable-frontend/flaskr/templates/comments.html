<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã¿ã‚“ãªã®ã‚³ãƒ¡ãƒ³ãƒˆ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* (ã“ã‚Œã¾ã§ã®CSSã¯ãã®ã¾ã¾) */
        .comment-container { max-width: 800px; margin: 0 auto; }
        .comment-form { background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 30px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .submit-btn { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; }
        .submit-btn:hover { background-color: #45a049; }
        .comment-list { list-style: none; padding: 0; }
        .comment-item { background: white; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .comment-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9em; color: #555; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .class-name { font-weight: bold; color: #007bff; background-color: #e7f1ff; padding: 2px 6px; border-radius: 4px; }
        .comment-body { font-size: 1.1em; line-height: 1.5; white-space: pre-wrap; }
        
        /* â–¼â–¼â–¼ è¿½åŠ ï¼šé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ */
        .flash-messages { margin-bottom: 20px; }
        .flash-message { padding: 10px; border-radius: 5px; margin-bottom: 10px; font-weight: bold; }
        .flash-error { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        .flash-success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

        /* â–¼â–¼â–¼ è¿½åŠ ï¼šå‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ */
        .delete-form { display: inline; }
        .delete-btn {
            background-color: #ff5252;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }
        .delete-btn:hover { background-color: #d32f2f; }
    </style>
</head>
<body>
    <header class="header"><h1>ğŸ’¬ æˆæ¥­ã®ã‚³ãƒ¡ãƒ³ãƒˆ</h1></header>
    
    <main class="main">
        <div class="comment-container">

            <div class="flash-messages">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash-message flash-{{ category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>

            <section class="comment-form">
                <h3>âœï¸ ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã</h3>
                <form method="POST" action="{{ url_for('comments') }}">
                    <div class="form-group">
                        <label for="lesson_select">ã©ã®æˆæ¥­ã«ã¤ã„ã¦ï¼Ÿ</label>
                        <select name="lesson_id" id="lesson_select" required>
                            <option value="">-- æˆæ¥­ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                            {% for lesson in lessons %}
                            <option value="{{ lesson.id }}">
                                {{ lesson.day_of_week }}{{ lesson.period }}é™: {{ lesson.title }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="content">å†…å®¹</label>
                        <textarea name="content" id="content" rows="3" placeholder="å…ˆç”Ÿã¸ã®æ‰¹åˆ¤ã§ã¯ãªãã€æˆæ¥­ã®æ”¹å–„ç‚¹ãªã©ã‚’æ›¸ãã¾ã—ã‚‡ã†" required></textarea>
                    </div>
                    <button type="submit" class="submit-btn">æŠ•ç¨¿ã™ã‚‹</button>
                </form>
            </section>

            <section>
                <h3>ã¿ã‚“ãªã®æŠ•ç¨¿ä¸€è¦§</h3>
                {% if comments %}
                    <ul class="comment-list">
                        {% for comment in comments %}
                        <li class="comment-item">
                            <div class="comment-header">
                                <div>
                                    <span class="class-name">
                                        {{ lesson_map[comment.lesson_id] if comment.lesson_id in lesson_map else 'ä¸æ˜ãªæˆæ¥­' }}
                                    </span>
                                    <span class="date">{{ comment.created_at.strftime('%Y/%m/%d %H:%M') }}</span>
                                </div>

                                {% if comment.user_id == current_user_id %}
                                    <form method="POST" action="{{ url_for('delete_comment', comment_id=comment.id) }}" class="delete-form" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                                        <button type="submit" class="delete-btn">å‰Šé™¤</button>
                                    </form>
                                {% endif %}
                                </div>
                            <div class="comment-body">{{ comment.content }}</div>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p style="text-align:center; color:#888; margin-top:30px;">
                        ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã‚ãªãŸãŒæœ€åˆã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
                    </p>
                {% endif %}
            </section>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="window.location.href='{{ url_for('home') }}'" class="icon-button" style="background:#555;">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            </div>
        </div>
    </main>
</body>
</html>